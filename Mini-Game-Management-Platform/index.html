<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Mini-Game HUB</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white">
    <div id="app" class="container mx-auto px-4 py-8">
        <div class="flex justify-end mb-8 p-4 bg-gray-800 rounded-xl">
            <div v-if="!user">
                <input v-model="auth.username" placeholder="ç”¨æˆ·å" class="bg-gray-700 px-2 py-1 rounded mr-2">
                <input v-model="auth.password" type="password" placeholder="å¯†ç " class="bg-gray-700 px-2 py-1 rounded mr-2">
                <button @click="handleAuth('login')" class="bg-blue-600 px-4 py-1 rounded mr-2">ç™»å½•</button>
                <button @click="handleAuth('register')" class="bg-green-600 px-4 py-1 rounded">æ³¨å†Œ</button>
            </div>
            <div v-else class="flex items-center">
                <img :src="user.avatar" class="w-8 h-8 rounded-full mr-2">
                <span class="mr-4">ä½ å¥½, {{ user.username }}</span>
                <button @click="logout" class="text-red-400">é€€å‡º</button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div v-for="game in games" :key="game.id" class="bg-gray-800 p-6 rounded-2xl border border-gray-700">
                <div class="text-4xl mb-2">{{ game.icon }}</div>
                <h3 class="text-xl font-bold">{{ game.name }}</h3>
                <p class="text-gray-400 text-sm mb-4">{{ game.desc }}</p>
                <a :href="game.url" class="block w-full bg-blue-600 text-center py-2 rounded-lg mb-2">å¼€å§‹æ¸¸æˆ</a>
                <button @click="fetchLeaderboard(game.id)" class="w-full text-blue-400 text-sm font-bold">ğŸ† æ’è¡Œæ¦œ</button>
            </div>
        </div>

        <div v-if="showBoard" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-8 rounded-2xl w-80 border border-gray-600">
                <h2 class="text-2xl font-bold mb-4">Top 10</h2>
                <div v-if="board.length === 0" class="text-gray-400 mb-4 text-center">æš‚æ— æ•°æ®</div>
                <div v-for="(s, i) in board" :key="i" class="flex justify-between mb-2">
                    <span class="flex items-center">
                        <span class="mr-2">{{i+1}}.</span>
                        <img :src="s.avatar_url || '/static/avatars/default.png'" class="w-6 h-6 rounded-full mr-2">
                        <span>{{s.player_name}}</span>
                    </span>
                    <span class="text-blue-400 font-bold">{{s.score}}</span>
                </div>
                <button @click="showBoard=false" class="w-full mt-4 bg-gray-700 py-2 rounded">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;
        createApp({
            setup() {
                const user = ref(JSON.parse(localStorage.getItem('user')));
                const games = ref([]);
                const board = ref([]);
                const showBoard = ref(false);
                const auth = ref({username: '', password: ''});

                const handleAuth = async (type) => {
                    const res = await fetch(`/api/${type}`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(auth.value)
                    });
                    const data = await res.json();
                    if(res.ok) {
                        if(type === 'login') {
                            user.value = data;
                            localStorage.setItem('user', JSON.stringify(data));
                        } else alert("æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•");
                    } else alert(data.detail);
                };

                const fetchLeaderboard = async (id) => {
                    const res = await fetch(`/api/scores/${id}`);
                    board.value = await res.json();
                    showBoard.value = true;
                };

                const logout = () => { user.value = null; localStorage.removeItem('user'); };

                onMounted(async () => {
                    const res = await fetch('/api/games');
                    games.value = await res.json();
                });

                return { user, games, board, showBoard, auth, handleAuth, fetchLeaderboard, logout }
            }
        }).mount('#app')
    </script>
</body>
</html>